<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Operaciones – MobCloud + Corte (Tabs)</title>

  <style>
    :root{
      --bg:#070a10;
      --card:#0d1117;
      --card2:#111a24;
      --txt:#e7edf6;
      --muted:#9fb0c3;
      --border:#223247;

      --success:#00ff88;
      --warning:#ffcc00;
      --danger:#ff4d4d;
      --accent:#00f2ff;

      --shadow: 0 10px 30px rgba(0,0,0,0.45);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(circle at 50% 0%, #121a24 0%, #070a10 60%, #05070c 100%);
      color:var(--txt);
      min-height:100vh;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:14px 18px;
      border-bottom:1px solid var(--border);
      background: rgba(7,10,16,0.6);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .brand{ display:flex; flex-direction:column; gap:2px; }
    .brand .title{ font-size:18px; font-weight:900; letter-spacing:0.06em; }
    .brand .sub{ font-size:12px; color:var(--muted); }

    .hdr-right{
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .pill{
      font-size:12px;
      color:var(--muted);
      padding:6px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      background: rgba(255,255,255,0.02);
    }

    .btn{
      font-size:12px;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #2b3e55;
      background:#132233;
      color:var(--txt);
      cursor:pointer;
    }
    .btn:hover{ filter: brightness(1.08); }
    .btn:disabled{ opacity:0.55; cursor:not-allowed; }

    .tabs{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .tab{
      border:1px solid var(--border);
      background: rgba(255,255,255,0.02);
      color:var(--muted);
      padding:8px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
      font-size:12px;
      letter-spacing:0.04em;
      user-select:none;
    }
    .tab.active{
      color: var(--txt);
      border-color: rgba(0,242,255,0.35);
      box-shadow: 0 0 0 2px rgba(0,242,255,0.08);
    }

    main{ padding:16px 18px 24px; display:grid; gap:14px; }
    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow: var(--shadow);
      padding:14px;
    }

    .grid{ display:grid; grid-template-columns: repeat(12, 1fr); gap:12px; }
    .span-12{ grid-column: span 12; }
    .span-8{ grid-column: span 8; }
    .span-7{ grid-column: span 7; }
    .span-6{ grid-column: span 6; }
    .span-5{ grid-column: span 5; }
    .span-4{ grid-column: span 4; }
    .span-3{ grid-column: span 3; }

    .k{
      font-size:11px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:var(--muted);
      margin-bottom:8px;
    }

    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    .field{ display:flex; flex-direction:column; gap:6px; min-width: 180px; }
    label{
      font-size:11px;
      color:var(--muted);
      letter-spacing:0.06em;
      text-transform:uppercase;
    }
    input, select{
      background: rgba(255,255,255,0.03);
      border:1px solid var(--border);
      color: var(--txt);
      border-radius:10px;
      padding:10px 10px;
      outline:none;
      font-size:13px;
    }
    input::placeholder{ color: rgba(159,176,195,0.6); }
    select option{ background:#0b111a; }

    .metrics{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    .metric{
      background: rgba(255,255,255,0.02);
      border:1px solid rgba(34,50,71,0.65);
      border-radius:14px;
      padding:12px;
    }
    .metric .m-k{ font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing:0.08em; }
    .metric .m-v{ font-size:26px; font-weight:900; margin-top:6px; }
    .metric .m-s{ font-size:12px; color:var(--muted); margin-top:4px; }

    table{ width:100%; border-collapse:collapse; font-size:13px; }
    th, td{
      padding:10px 8px;
      border-bottom:1px solid rgba(34,50,71,0.7);
      vertical-align:top;
    }
    th{
      text-align:left;
      color:var(--muted);
      font-size:11px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      font-weight:800;
    }

    .tag{
      display:inline-block;
      padding:3px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      color:var(--muted);
      font-size:12px;
      font-weight:800;
    }
    .tag.ok{ color: var(--success); border-color: rgba(0,255,136,0.25); background: rgba(0,255,136,0.06); }
    .tag.warn{ color: var(--warning); border-color: rgba(255,204,0,0.25); background: rgba(255,204,0,0.06); }
    .tag.bad{ color: var(--danger); border-color: rgba(255,77,77,0.25); background: rgba(255,77,77,0.06); }
    .tag.info{ color:#66b3ff; border-color: rgba(102,179,255,0.25); background: rgba(102,179,255,0.06); }

    .muted{ color: var(--muted); }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    .right{ text-align:right; }
    .nowrap{ white-space:nowrap; }
    .hidden{ display:none !important; }

    /* Print */
    @media print {
      header, .no-print { display:none !important; }
      body { background: white !important; color: #111 !important; }
      .card { box-shadow:none !important; border: 1px solid #ddd !important; }
      table, th, td { border-color:#ddd !important; color:#111 !important; }
      .tag { border-color:#999 !important; color:#111 !important; background:transparent !important; }
      .muted { color:#333 !important; }

      /* Imprimir solo Pre Packing */
      main > section { display:none !important; }
      #tab-packing { display:block !important; }
    }
  </style>
</head>

<body>
<header>
  <div class="brand">
    <div class="title">OPERACIONES</div>
    <div class="sub">MobCloud + Corte • Supabase</div>
  </div>

  <div class="hdr-right">
    <div class="tabs no-print">
      <div class="tab active" data-tab="produccion">Producción</div>
      <div class="tab" data-tab="compras">Compras</div>
      <div class="tab" data-tab="imprimir">Imprimir</div>
      <div class="tab" data-tab="complejidad">Complejidad</div>
      <div class="tab" data-tab="packing">Pre Packing</div>
    </div>

    <div class="pill">SYNC: <span id="lastSync">-</span></div>
    <button class="btn no-print" id="btnRefresh">Refrescar</button>
  </div>
</header>

<main>
  <!-- TAB: PRODUCCION -->
  <section id="tab-produccion" class="card">
    <div class="k">Producción • Backlog</div>

    <div class="grid no-print">
      <div class="span-12">
        <div class="row">
          <div class="field">
            <label>Línea</label>
            <select id="prodLine"><option value="">Todas</option></select>
          </div>

          <div class="field">
            <label>Estados</label>
            <input id="prodStatus" value="7,13,17,18,19,21,22"/>
          </div>

          <div class="field">
            <label>Buscar (código/cliente)</label>
            <input id="prodSearch" placeholder="CJ7 / U901 / cliente..." />
          </div>

          <div class="field">
            <label>Mostrar</label>
            <select id="prodLimit">
              <option value="50">50</option>
              <option value="100" selected>100</option>
              <option value="200">200</option>
              <option value="500">500</option>
            </select>
          </div>
        </div>
      </div>

      <div class="span-12">
        <div class="metrics">
          <div class="metric">
            <div class="m-k">Servicios</div>
            <div class="m-v" id="mServices">-</div>
            <div class="m-s">filtrados</div>
          </div>
          <div class="metric">
            <div class="m-k">Vencidos</div>
            <div class="m-v" id="mOverdue">-</div>
            <div class="m-s">estimated_delivery &lt; hoy</div>
          </div>
          <div class="metric">
            <div class="m-k">Con enchape</div>
            <div class="m-v" id="mEdge">-</div>
            <div class="m-s">edge_used = 1</div>
          </div>
          <div class="metric">
            <div class="m-k">Con mecanizado</div>
            <div class="m-v" id="mMach">-</div>
            <div class="m-s">machining_used = 1</div>
          </div>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="span-12">
        <table>
          <thead>
          <tr>
            <th class="nowrap">Entrega</th>
            <th>Servicio</th>
            <th>Línea</th>
            <th class="nowrap">Status</th>
            <th class="nowrap">Corte</th>
            <th class="nowrap">Enchape</th>
            <th class="nowrap">Mecanizado</th>
            <th class="nowrap">Packing</th>
            <th class="right nowrap">Cut (plan)</th>
          </tr>
          </thead>
          <tbody id="prodTbody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- TAB: COMPRAS -->
  <section id="tab-compras" class="card hidden">
    <div class="k">Compras • Próximos días</div>

    <div class="grid no-print">
      <div class="span-12">
        <div class="row">
          <div class="field">
            <label>Próximos días</label>
            <select id="buyDays">
              <option value="7" selected>7</option>
              <option value="14">14</option>
              <option value="30">30</option>
            </select>
          </div>

          <div class="field">
            <label>Línea</label>
            <select id="buyLine"><option value="">Todas</option></select>
          </div>

          <div class="field">
            <label>Estados</label>
            <input id="buyStatus" value="7,13,17,18,19,21,22"/>
          </div>

          <div class="field">
            <label>Buscar item</label>
            <input id="buySearch" placeholder="tabl/058 / parana / tornillo..." />
          </div>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="span-12">
        <table>
          <thead>
          <tr>
            <th>Categoría</th>
            <th>Item</th>
            <th>Descripción</th>
            <th class="right">Cantidad</th>
            <th>Unidad</th>
            <th class="right">Costo est.</th>
          </tr>
          </thead>
          <tbody id="buyTbody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- TAB: IMPRIMIR -->
  <section id="tab-imprimir" class="card hidden">
    <div class="k">Imprimir • Checklist herrajes</div>

    <div class="grid no-print">
      <div class="span-12">
        <div class="row">
          <div class="field" style="min-width:340px;">
            <label>Servicio</label>
            <select id="printService"><option value="">Seleccionar...</option></select>
          </div>

          <button class="btn" id="btnLoadChecklist">Cargar checklist</button>
          <button class="btn" id="btnPrint" disabled>Imprimir</button>
        </div>
        <div class="sub" style="margin-top:10px;">
          Tip: elegí un servicio y presioná “Cargar checklist”. Luego “Imprimir”.
        </div>
      </div>
    </div>

    <div id="printArea" class="grid">
      <div class="span-12">
        <div class="row" style="justify-content:space-between; align-items:flex-start;">
          <div>
            <div style="font-size:18px; font-weight:900;">Checklist de herrajes</div>
            <div class="muted" id="printHeader">—</div>
          </div>
          <div class="mono muted" id="printServiceId"></div>
        </div>
      </div>

      <div class="span-12">
        <table>
          <thead>
          <tr>
            <th style="width:52px;">OK</th>
            <th>Componente</th>
            <th class="right nowrap">Cant.</th>
            <th class="nowrap">Código</th>
            <th class="right nowrap">Redondeo</th>
          </tr>
          </thead>
          <tbody id="printTbody"></tbody>
        </table>
      </div>

      <div class="span-12 muted" style="font-size:12px;">
        Nota: “Cant.” es la cantidad real para preparar. Si un ítem viene en pack/caja grande, se muestra “Compra sugerida”.
      </div>
    </div>
  </section>

  <!-- TAB: COMPLEJIDAD -->
  <section id="tab-complejidad" class="card hidden">
    <div class="k">Complejidad & Programación sugerida</div>
    <!-- (sin cambios en este tab respecto a tu versión) -->
    <!-- ... tu contenido actual de complejidad ... -->
    <div class="muted">Este tab queda igual a tu versión operativa.</div>
  </section>

  <!-- TAB: PRE PACKING -->
  <section id="tab-packing" class="card hidden">
    <div class="k">Pre Packing • Control por módulo</div>
    <div class="muted" id="packPrintHeader" style="margin-bottom:10px;"></div>

    <div class="grid no-print">
      <div class="span-12">
        <div class="row">
          <div class="field" style="min-width:340px;">
            <label>Servicio</label>
            <select id="packService">
              <option value="">Seleccionar...</option>
            </select>
          </div>

          <div class="field" style="min-width:260px;">
            <label>Scan piece_id</label>
            <input id="packScan" placeholder="Escanear y Enter..." />
          </div>

          <button class="btn" id="btnPackReset" disabled>Resetear</button>
          <button class="btn" id="btnPackUndo" disabled>Deshacer último</button>
          <button class="btn" id="btnPackPrint" disabled>Imprimir remito interno</button>

          <div class="pill">Progreso: <span id="packProgressLbl">-</span></div>
        </div>
        <div class="muted" style="margin-top:8px;">
          Tip: escaneá el ID de la pieza. Cada scan suma 1 hasta completar la cantidad esperada.
        </div>
      </div>

      <div class="span-12">
        <div class="metrics">
          <div class="metric">
            <div class="m-k">Esperadas</div>
            <div class="m-v" id="packExpected">-</div>
            <div class="m-s">piezas (qty)</div>
          </div>
          <div class="metric">
            <div class="m-k">Escaneadas</div>
            <div class="m-v" id="packScanned">-</div>
            <div class="m-s">packing_ready</div>
          </div>
          <div class="metric">
            <div class="m-k">Faltantes</div>
            <div class="m-v" id="packMissing">-</div>
            <div class="m-s">alerta si &gt; 0</div>
          </div>
          <div class="metric">
            <div class="m-k">Módulos completos</div>
            <div class="m-v" id="packModulesOk">-</div>
            <div class="m-s">de <span id="packModulesTotal">-</span></div>
          </div>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="span-5">
        <div class="k">Módulos</div>
        <table>
          <thead>
          <tr>
            <th>Módulo</th>
            <th class="right">OK</th>
            <th class="right">Faltan</th>
          </tr>
          </thead>
          <tbody id="packModulesTbody"></tbody>
        </table>
      </div>

      <div class="span-7">
        <div class="k">Piezas</div>
        <table>
          <thead>
          <tr>
            <th>Pieza</th>
            <th class="right nowrap">Esc/Exp</th>
            <th class="right nowrap">Faltan</th>
          </tr>
          </thead>
          <tbody id="packPiecesTbody"></tbody>
        </table>
      </div>
    </div>
  </section>

</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  // ========= CONFIG =========
  const SUPABASE_URL = "https://qnjizqowddtvzzfillmo.supabase.co";
  const SUPABASE_ANON_KEY = "sb_publishable_Agu_I1nw4mY1qRARQBbaHQ_6lTWsFTh";
  // ==========================

  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  function fmtDate(isoDate){ return isoDate ? isoDate : "-"; }
  function escapeHtml(s){
    return String(s ?? "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }
  function csvToSet(csv){
    const raw = (csv||"").split(",").map(x=>x.trim()).filter(Boolean);
    return new Set(raw);
  }

  // Tabs
  const tabs = document.querySelectorAll(".tab");
  function setTab(name){
    tabs.forEach(t => t.classList.toggle("active", t.dataset.tab === name));
    document.getElementById("tab-produccion").classList.toggle("hidden", name!=="produccion");
    document.getElementById("tab-compras").classList.toggle("hidden", name!=="compras");
    document.getElementById("tab-imprimir").classList.toggle("hidden", name!=="imprimir");
    document.getElementById("tab-complejidad").classList.toggle("hidden", name!=="complejidad");
    document.getElementById("tab-packing").classList.toggle("hidden", name!=="packing");
  }
  tabs.forEach(t => t.addEventListener("click", () => setTab(t.dataset.tab)));

  let cachedServices = [];

  async function refreshServices(){
    const { data, error } = await sb
      .from("mob_services")
      .select("service_id, internal_code, clients_names, production_line_name, status, estimated_delivery")
      .order("estimated_delivery", { ascending: true, nullsFirst: false })
      .limit(10000);
    if(error) throw error;
    cachedServices = data || [];
  }

  function populatePackingServiceSelect(){
    const sel = document.getElementById("packService");
    sel.innerHTML = `<option value="">Seleccionar...</option>` +
      cachedServices.slice()
        .sort((a,b)=>String(a.internal_code||"").localeCompare(String(b.internal_code||"")))
        .map(s => {
          const label = `${s.internal_code || s.service_id} — ${s.clients_names || ""}`.trim();
          return `<option value="${s.service_id}">${escapeHtml(label)}</option>`;
        }).join("");
  }

  async function loadPackingData(serviceId){
    const { data: svcProg, error: e1 } = await sb
      .from("vw_packing_service_progress")
      .select("service_id, expected, scanned, missing, excess, complete")
      .eq("service_id", serviceId)
      .maybeSingle();
    if (e1) throw e1;

    const { data: mods, error: e2 } = await sb
      .from("vw_packing_module_progress")
      .select("module_label, expected, scanned, missing, excess, complete")
      .eq("service_id", serviceId)
      .order("module_label", { ascending: true });
    if (e2) throw e2;

    const { data: pieces, error: e3 } = await sb
      .from("vw_packing_piece_progress")
      .select("module_label, piece_id, piece_label, qty_expected, qty_scanned, qty_missing, qty_excess, sequence")
      .eq("service_id", serviceId)
      .order("module_label", { ascending: true })
      .order("sequence", { ascending: true })
      .order("piece_id", { ascending: true });
    if (e3) throw e3;

    renderPacking(serviceId, svcProg, mods || [], pieces || []);
  }

  function renderPacking(serviceId, svcProg, mods, pieces){
    const expected = Number(svcProg?.expected || 0);
    const scanned  = Number(svcProg?.scanned || 0);
    const missing  = Number(svcProg?.missing || 0);

    document.getElementById("packExpected").textContent = expected.toFixed(0);
    document.getElementById("packScanned").textContent = scanned.toFixed(0);
    document.getElementById("packMissing").textContent = missing.toFixed(0);

    const okMods = mods.filter(m => m.complete).length;
    document.getElementById("packModulesOk").textContent = okMods;
    document.getElementById("packModulesTotal").textContent = mods.length;

    const pct = expected > 0 ? Math.round((scanned/expected)*100) : 0;
    document.getElementById("packProgressLbl").textContent = `${scanned.toFixed(0)}/${expected.toFixed(0)} (${pct}%)`;

    // habilitar botones
    document.getElementById("btnPackPrint").disabled = (expected === 0);
    document.getElementById("btnPackReset").disabled = (serviceId ? false : true);
    document.getElementById("btnPackUndo").disabled = (serviceId ? false : true);

    // Header impresión con resumen + módulos completos
    const svc = cachedServices.find(s => Number(s.service_id) === Number(serviceId));
    const nowStr = new Date().toLocaleString();
    const name = svc?.internal_code ? svc.internal_code : `SERVICE_${serviceId}`;
    const client = svc?.clients_names ? ` • ${svc.clients_names}` : "";
    const hdr = document.getElementById("packPrintHeader");
    if (hdr) {
      hdr.textContent = `${name}${client} • REMITO INTERNO • ${nowStr} • Piezas: ${scanned}/${expected} • Faltan: ${missing} • Módulos completos: ${okMods}/${mods.length}`;
    }

    // Módulos
    const mt = document.getElementById("packModulesTbody");
    mt.innerHTML = "";
    for(const m of mods){
      const tag = m.complete ? `<span class="tag ok">OK</span>` : `<span class="tag warn">PEND</span>`;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>
          <div style="font-weight:900;">${escapeHtml(m.module_label)}</div>
          <div class="muted" style="font-size:12px;">${tag} • ${Number(m.scanned||0).toFixed(0)}/${Number(m.expected||0).toFixed(0)}</div>
        </td>
        <td class="right">${m.complete ? "✅" : "—"}</td>
        <td class="right">${Number(m.missing||0).toFixed(0)}</td>
      `;
      mt.appendChild(tr);
    }

    // Piezas
    const pt = document.getElementById("packPiecesTbody");
    pt.innerHTML = "";
    for(const p of pieces){
      const exp = Number(p.qty_expected||0);
      const sc  = Number(p.qty_scanned||0);
      const mis = Number(p.qty_missing||0);
      const exc = Number(p.qty_excess||0);

      let status;
      if (exc > 0) status = `<span class="tag info">EXCESO</span>`;
      else if (mis === 0 && exp > 0) status = `<span class="tag ok">OK</span>`;
      else status = `<span class="tag bad">FALTA</span>`;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>
          <div style="font-weight:900;">${escapeHtml(p.module_label)}</div>
          <div class="muted">${escapeHtml(p.piece_label)}</div>
          <div class="mono muted">piece_id: ${p.piece_id}</div>
        </td>
        <td class="right nowrap">${status} <span class="mono">${sc}/${exp}</span></td>
        <td class="right nowrap">${mis.toFixed(0)}</td>
      `;
      pt.appendChild(tr);
    }
  }

  async function scanPackingPiece(serviceId, pieceId){
    const { error } = await sb.rpc("fn_packing_ready_scan", {
      p_service_id: Number(serviceId),
      p_piece_id: Number(pieceId),
      p_qty: 1,
      p_scanned_by: null
    });
    if (error) throw error;
  }

  // --- Eventos Pre Packing ---
  document.getElementById("packService").addEventListener("change", async () => {
    const sid = Number(document.getElementById("packService").value);
    if(!sid) return;
    await loadPackingData(sid);
  });

  // Scan con Enter
  document.getElementById("packScan").addEventListener("keydown", async (ev) => {
    if (ev.key !== "Enter") return;

    const sid = Number(document.getElementById("packService").value);
    const txt = document.getElementById("packScan").value.trim();
    if(!sid || !txt) return;

    const pieceId = Number(txt.replace(/\D/g,''));
    if(!pieceId) return;

    document.getElementById("packScan").value = "";

    try{
      await scanPackingPiece(sid, pieceId);
      await loadPackingData(sid);
    } catch(e){
      console.error(e);
      alert("No pude registrar el scan. Revisá que el piece_id pertenezca al servicio.");
    }
  });

  // Reset
  document.getElementById("btnPackReset").addEventListener("click", async () => {
    const sid = Number(document.getElementById("packService").value);
    if(!sid) return;
    if(!confirm("¿Resetear el control de este servicio? Se borrarán todos los scans de Pre Packing.")) return;

    const { error } = await sb.rpc("fn_packing_ready_reset", { p_service_id: sid });
    if (error) { alert("No pude resetear."); console.error(error); return; }

    await loadPackingData(sid);
  });

  // Undo último
  document.getElementById("btnPackUndo").addEventListener("click", async () => {
    const sid = Number(document.getElementById("packService").value);
    if(!sid) return;

    const { error } = await sb.rpc("fn_packing_ready_undo", { p_service_id: sid });
    if (error) { alert("No pude deshacer."); console.error(error); return; }

    await loadPackingData(sid);
  });

  // Imprimir remito interno (con nombre sugerido)
  document.getElementById("btnPackPrint").addEventListener("click", async () => {
    setTab("packing");
    const sid = Number(document.getElementById("packService").value);
    if (!sid) { alert("Seleccioná un servicio antes de imprimir."); return; }

    await loadPackingData(sid);

    const svc = cachedServices.find(s => Number(s.service_id) === sid);
    const serviceName = svc?.internal_code ? svc.internal_code : `SERVICE_${sid}`;

    const oldTitle = document.title;
    document.title = `${serviceName} - REMITO INTERNO`;
    window.print();
    setTimeout(() => { document.title = oldTitle; }, 500);
  });

  async function boot(){
    try{
      await refreshServices();
      populatePackingServiceSelect();
      document.getElementById("lastSync").textContent = new Date().toLocaleTimeString();
    } catch (e){
      console.error(e);
      document.getElementById("lastSync").textContent = "ERROR";
      alert("Error cargando datos. Revisá consola (F12).");
    }
  }

  boot();
</script>
</body>
</html>
